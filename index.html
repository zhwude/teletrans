<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>摩斯密码表白器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B8B',
                        secondary: '#FFCCD8',
                        light: '#FFF5F7',
                        dark: '#333333',
                        accent: '#FF3366',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .floating-heart {
                position: absolute;
                opacity: 0;
                color: #FF6B8B;
                font-size: 24px;
                animation: floatHeart 5s forwards;
            }
            .morse-dot {
                display: inline-block;
                width: 10px;
                height: 10px;
                background-color: #FF6B8B;
                border-radius: 50%;
                margin: 0 2px;
            }
            .morse-dash {
                display: inline-block;
                width: 30px;
                height: 10px;
                background-color: #FF6B8B;
                border-radius: 5px;
                margin: 0 2px;
            }
            .morse-active {
                background-color: #FF3366;
                box-shadow: 0 0 15px #FF3366;
            }
            .sound-toggle {
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 40px;
                height: 40px;
                background-color: rgba(255, 107, 139, 0.8);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                cursor: pointer;
                z-index: 10;
                transition: all 0.3s;
            }
            .sound-toggle:hover {
                transform: scale(1.1);
                background-color: rgba(255, 51, 102, 0.9);
            }
        }

        @keyframes floatHeart {
            0% {
                bottom: -50px;
                opacity: 0;
                transform: translateX(0) rotate(0deg);
            }
            20% {
                opacity: 0.8;
            }
            100% {
                bottom: 100vh;
                opacity: 0;
                transform: translateX(100px) rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-light to-secondary min-h-screen flex flex-col items-center justify-center p-4 font-sans">
    <div class="max-w-md w-full mx-auto text-center relative overflow-hidden">
        <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-primary mb-8">摩斯密码表白器</h1>
        
        <div class="mb-8">
            <input type="text" id="messageInput" 
                class="w-full px-4 py-3 rounded-full border-2 border-secondary focus:border-primary focus:outline-none transition-all" 
                placeholder="请输入演绎内容">
            <button id="convertBtn" 
                class="mt-4 px-6 py-3 bg-primary text-white rounded-full hover:bg-primary/90 transition-all transform hover:scale-105 focus:outline-none">
                开始表白
            </button>
        </div>
        
        <div id="heartContainer" class="py-12 my-8 flex justify-center">
            <div id="heart" class="text-[clamp(8rem,20vw,12rem)] text-primary transition-all duration-150">
                <i class="fa fa-heart"></i>
            </div>
        </div>
        
        <div id="morseDisplay" class="mb-8 opacity-0 transition-opacity duration-500">
            <p class="text-dark/70 mb-2">您的摩斯密码：</p>
            <div id="morseCode" class="text-lg font-medium text-primary flex justify-center items-center flex-wrap gap-2"></div>
        </div>
        
        <div id="messageDisplay" class="mb-8 opacity-0 transition-opacity duration-500">
            <p class="text-dark/70 mb-2">您的表白内容：</p>
            <p id="displayMessage" class="text-xl font-medium text-primary"></p>
        </div>
        
        <div id="heartDisplay" class="mt-8 opacity-0 transition-opacity duration-500">
            <p class="text-dark/70 mb-2">摩斯密码翻译：</p>
            <p id="morseTranslation" class="text-lg font-medium text-primary"></p>
        </div>
    </div>
    
    <div id="floatingHearts" class="fixed inset-0 pointer-events-none z-0"></div>
    
    <!-- 音效控制按钮 -->
    <div id="soundToggle" class="sound-toggle">
        <i class="fa fa-volume-up"></i>
    </div>

    <!-- 音频元素 -->
    <audio id="dotSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-quick-guitar-pluck-2343.mp3" type="audio/mpeg">
    </audio>
    <audio id="dashSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-electric-guitar-tone-2341.mp3" type="audio/mpeg">
    </audio>

    <script>
        // 音效控制
        let soundEnabled = true;
        let audioContext;
        let audioInitialized = false;
        
        // 初始化音频上下文
        function initAudio() {
            if (audioInitialized) return;
            
            try {
                // 创建音频上下文
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // 恢复音频上下文（解决自动播放限制）
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        console.log('音频上下文已恢复');
                    }).catch(e => {
                        console.error('无法恢复音频上下文:', e);
                    });
                }
                
                audioInitialized = true;
            } catch (e) {
                console.error('音频初始化失败:', e);
                soundEnabled = false;
                document.getElementById('soundToggle').innerHTML = '<i class="fa fa-volume-off"></i>';
            }
        }
        
        // 切换音效开关
        document.getElementById('soundToggle').addEventListener('click', function() {
            soundEnabled = !soundEnabled;
            const icon = this.querySelector('i');
            if (soundEnabled) {
                icon.className = 'fa fa-volume-up';
            } else {
                icon.className = 'fa fa-volume-off';
            }
        });
        
        // 播放音效
        function playSound(type) {
            if (!soundEnabled) return;
            
            // 确保音频上下文已初始化
            if (!audioInitialized) {
                initAudio();
            }
            
            const dotSound = document.getElementById('dotSound');
            const dashSound = document.getElementById('dashSound');
            
            try {
                const sound = type === '.' ? dotSound : dashSound;
                
                // 重置音频并播放
                sound.currentTime = 0;
                sound.play().then(() => {
                    console.log(`${type === '.' ? '点' : '划'}音效播放成功`);
                }).catch(e => {
                    console.error(`音效播放失败:`, e);
                    // 尝试重新初始化音频
                    audioInitialized = false;
                    initAudio();
                });
            } catch (e) {
                console.error('播放音效时发生错误:', e);
            }
        }

        // 摩斯密码映射表
        const morseCodeMap = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 'G': '--.', 
            'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 
            'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-', 'U': '..-', 
            'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--', 'Z': '--..',
            '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....', 
            '6': '-....', '7': '--...', '8': '---..', '9': '----.', '0': '-----',
            ' ': '/', '.': '.-.-.-', ',': '--..--', '?': '..--..', "'": '.----.', 
            '!': '-.-.--', '/': '-..-.', '(': '-.--.', ')': '-.--.-', '&': '.-...', 
            ':': '---...', ';': '-.-.-.', '=': '-...-', '+': '.-.-.', '-': '-....-', 
            '_': '..--.-', '"': '.-..-.', '$': '...-..-', '@': '.--.-.'
        };

        // 反转映射表，用于翻译
        const reverseMorseMap = Object.fromEntries(
            Object.entries(morseCodeMap).map(([key, value]) => [value, key])
        );

        // 字符转摩斯密码
        function textToMorse(text) {
            return text.toUpperCase().split('').map(char => 
                morseCodeMap[char] || char
            ).join(' ');
        }

        // 摩斯密码转字符
        function morseToText(morse) {
            return morse.split(' ').map(code => 
                reverseMorseMap[code] || code
            ).join('');
        }

        // 生成爱心弹幕
        function createFloatingHeart() {
            const hearts = ['❤️', '💖', '💗', '💓', '💕', '💝', '💞'];
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = hearts[Math.floor(Math.random() * hearts.length)];
            
            // 随机位置和动画时间
            heart.style.left = `${Math.random() * 100}vw`;
            heart.style.animationDuration = `${5 + Math.random() * 10}s`;
            heart.style.fontSize = `${16 + Math.random() * 24}px`;
            heart.style.opacity = `${0.5 + Math.random() * 0.5}`;
            
            document.getElementById('floatingHearts').appendChild(heart);
            
            // 动画结束后移除元素
            setTimeout(() => {
                heart.remove();
            }, 15000);
        }

        // 控制爱心闪烁
        function blinkHeart(morseCode) {
            const heart = document.getElementById('heart');
            const symbols = morseCode.split('');
            let index = 0;
            
            // 创建摩斯密码显示
            const morseDisplay = document.getElementById('morseCode');
            morseDisplay.innerHTML = '';
            
            // 存储每个符号的元素引用
            const symbolElements = [];
            
            symbols.forEach(symbol => {
                const element = document.createElement('span');
                if (symbol === '.') {
                    element.className = 'morse-dot';
                } else if (symbol === '-') {
                    element.className = 'morse-dash';
                } else if (symbol === ' ') {
                    element.innerHTML = '&nbsp;&nbsp;';
                } else if (symbol === '/') {
                    element.innerHTML = '&nbsp;&nbsp;&nbsp;&nbsp;';
                }
                morseDisplay.appendChild(element);
                symbolElements.push(element);
            });
            
            // 显示翻译结果
            document.getElementById('displayMessage').textContent = document.getElementById('messageInput').value;
            document.getElementById('morseTranslation').textContent = morseCode;
            
            // 显示所有内容
            document.getElementById('morseDisplay').classList.remove('opacity-0');
            document.getElementById('messageDisplay').classList.remove('opacity-0');
            document.getElementById('heartDisplay').classList.remove('opacity-0');
            
            // 摩斯密码标准时间单位（毫秒）
            const timeUnit = 200;
            
            // 重置爱心状态
            function resetHeart() {
                heart.style.transform = 'scale(1)';
                heart.style.color = '#FF6B8B';
                heart.style.boxShadow = '0 0 0 rgba(255, 51, 102, 0)';
                
                // 清除所有符号的活动状态
                symbolElements.forEach(el => {
                    if (el.classList.contains('morse-active')) {
                        el.classList.remove('morse-active');
                    }
                });
            }
            
            // 激活爱心状态
            function activateHeart() {
                heart.style.transform = 'scale(1.3)';
                heart.style.color = '#FF3366';
                heart.style.boxShadow = '0 0 20px rgba(255, 51, 102, 0.7)';
                
                // 激活当前符号
                const currentElement = symbolElements[index];
                if (currentElement) currentElement.classList.add('morse-active');
            }
            
            // 开始闪烁动画
            function nextBlink() {
                if (index >= symbols.length) {
                    resetHeart();
                    setTimeout(() => {
                        index = 0;
                        nextBlink();
                    }, timeUnit * 7); // 单词间间隔：7个时间单位
                    return;
                }
                
                const symbol = symbols[index];
                
                // 重置状态
                resetHeart();
                
                if (symbol === '.') {
                    // 点：1个时间单位
                    activateHeart();
                    playSound('.');
                    
                    setTimeout(() => {
                        resetHeart();
                        index++;
                        setTimeout(nextBlink, timeUnit); // 字符内间隔：1个时间单位
                    }, timeUnit);
                } else if (symbol === '-') {
                    // 划：3个时间单位
                    activateHeart();
                    playSound('-');
                    
                    setTimeout(() => {
                        resetHeart();
                        index++;
                        setTimeout(nextBlink, timeUnit); // 字符内间隔：1个时间单位
                    }, timeUnit * 3);
                } else if (symbol === ' ') {
                    // 字符间空格：3个时间单位
                    index++;
                    setTimeout(nextBlink, timeUnit * 3);
                } else if (symbol === '/') {
                    // 单词间空格：7个时间单位
                    index++;
                    setTimeout(nextBlink, timeUnit * 7);
                } else {
                    // 其他字符：1个时间单位
                    index++;
                    setTimeout(nextBlink, timeUnit);
                }
            }
            
            // 开始动画序列
            setTimeout(nextBlink, timeUnit * 2);
        }

        // 点击按钮事件
        document.getElementById('convertBtn').addEventListener('click', function() {
            const message = document.getElementById('messageInput').value.trim();
            if (!message) {
                alert('请输入要转换的内容！');
                return;
            }
            
            // 初始化音频（如果尚未初始化）
            initAudio();
            
            // 转换为摩斯密码
            const morseCode = textToMorse(message);
            
            // 开始爱心闪烁
            blinkHeart(morseCode);
            
            // 清除现有爱心弹幕
            document.getElementById('floatingHearts').innerHTML = '';
            
            // 生成新的爱心弹幕
            const heartInterval = setInterval(createFloatingHeart, 300);
            
            // 15秒后停止生成新爱心
            setTimeout(() => {
                clearInterval(heartInterval);
            }, 15000);
        });

        // 回车触发转换
        document.getElementById('messageInput').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                document.getElementById('convertBtn').click();
            }
        });
    </script>
</body>
</html>    
