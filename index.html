<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘©æ–¯å¯†ç è¡¨ç™½å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B8B',
                        secondary: '#FFCCD8',
                        light: '#FFF5F7',
                        dark: '#333333',
                        accent: '#FF3366',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .floating-heart {
                position: absolute;
                opacity: 0;
                color: #FF6B8B;
                font-size: 24px;
                animation: floatHeart 5s forwards;
            }
            .morse-dot {
                display: inline-block;
                width: 10px;
                height: 10px;
                background-color: #FF6B8B;
                border-radius: 50%;
                margin: 0 2px;
            }
            .morse-dash {
                display: inline-block;
                width: 30px;
                height: 10px;
                background-color: #FF6B8B;
                border-radius: 5px;
                margin: 0 2px;
            }
            .morse-active {
                background-color: #FF3366;
                box-shadow: 0 0 15px #FF3366;
            }
            .sound-toggle {
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 40px;
                height: 40px;
                background-color: rgba(255, 107, 139, 0.8);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                cursor: pointer;
                z-index: 10;
                transition: all 0.3s;
            }
            .sound-toggle:hover {
                transform: scale(1.1);
                background-color: rgba(255, 51, 102, 0.9);
            }
        }

        @keyframes floatHeart {
            0% {
                bottom: -50px;
                opacity: 0;
                transform: translateX(0) rotate(0deg);
            }
            20% {
                opacity: 0.8;
            }
            100% {
                bottom: 100vh;
                opacity: 0;
                transform: translateX(100px) rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-light to-secondary min-h-screen flex flex-col items-center justify-center p-4 font-sans">
    <div class="max-w-md w-full mx-auto text-center relative overflow-hidden">
        <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-primary mb-8">æ‘©æ–¯å¯†ç è¡¨ç™½å™¨</h1>
        
        <div class="mb-8">
            <input type="text" id="messageInput" 
                class="w-full px-4 py-3 rounded-full border-2 border-secondary focus:border-primary focus:outline-none transition-all" 
                placeholder="è¯·è¾“å…¥æ¼”ç»å†…å®¹">
            <button id="convertBtn" 
                class="mt-4 px-6 py-3 bg-primary text-white rounded-full hover:bg-primary/90 transition-all transform hover:scale-105 focus:outline-none">
                å¼€å§‹è¡¨ç™½
            </button>
        </div>
        
        <div id="heartContainer" class="py-12 my-8 flex justify-center">
            <div id="heart" class="text-[clamp(8rem,20vw,12rem)] text-primary transition-all duration-150">
                <i class="fa fa-heart"></i>
            </div>
        </div>
        
        <div id="morseDisplay" class="mb-8 opacity-0 transition-opacity duration-500">
            <p class="text-dark/70 mb-2">æ‚¨çš„æ‘©æ–¯å¯†ç ï¼š</p>
            <div id="morseCode" class="text-lg font-medium text-primary flex justify-center items-center flex-wrap gap-2"></div>
        </div>
        
        <div id="messageDisplay" class="mb-8 opacity-0 transition-opacity duration-500">
            <p class="text-dark/70 mb-2">æ‚¨çš„è¡¨ç™½å†…å®¹ï¼š</p>
            <p id="displayMessage" class="text-xl font-medium text-primary"></p>
        </div>
        
        <div id="heartDisplay" class="mt-8 opacity-0 transition-opacity duration-500">
            <p class="text-dark/70 mb-2">æ‘©æ–¯å¯†ç ç¿»è¯‘ï¼š</p>
            <p id="morseTranslation" class="text-lg font-medium text-primary"></p>
        </div>
    </div>
    
    <div id="floatingHearts" class="fixed inset-0 pointer-events-none z-0"></div>
    
    <!-- éŸ³æ•ˆæ§åˆ¶æŒ‰é’® -->
    <div id="soundToggle" class="sound-toggle">
        <i class="fa fa-volume-up"></i>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="dotSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-quick-guitar-pluck-2343.mp3" type="audio/mpeg">
    </audio>
    <audio id="dashSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-electric-guitar-tone-2341.mp3" type="audio/mpeg">
    </audio>

    <script>
        // éŸ³æ•ˆæ§åˆ¶
        let soundEnabled = true;
        let audioContext;
        let audioInitialized = false;
        
        // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
        function initAudio() {
            if (audioInitialized) return;
            
            try {
                // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // æ¢å¤éŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆè§£å†³è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼‰
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        console.log('éŸ³é¢‘ä¸Šä¸‹æ–‡å·²æ¢å¤');
                    }).catch(e => {
                        console.error('æ— æ³•æ¢å¤éŸ³é¢‘ä¸Šä¸‹æ–‡:', e);
                    });
                }
                
                audioInitialized = true;
            } catch (e) {
                console.error('éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:', e);
                soundEnabled = false;
                document.getElementById('soundToggle').innerHTML = '<i class="fa fa-volume-off"></i>';
            }
        }
        
        // åˆ‡æ¢éŸ³æ•ˆå¼€å…³
        document.getElementById('soundToggle').addEventListener('click', function() {
            soundEnabled = !soundEnabled;
            const icon = this.querySelector('i');
            if (soundEnabled) {
                icon.className = 'fa fa-volume-up';
            } else {
                icon.className = 'fa fa-volume-off';
            }
        });
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(type) {
            if (!soundEnabled) return;
            
            // ç¡®ä¿éŸ³é¢‘ä¸Šä¸‹æ–‡å·²åˆå§‹åŒ–
            if (!audioInitialized) {
                initAudio();
            }
            
            const dotSound = document.getElementById('dotSound');
            const dashSound = document.getElementById('dashSound');
            
            try {
                const sound = type === '.' ? dotSound : dashSound;
                
                // é‡ç½®éŸ³é¢‘å¹¶æ’­æ”¾
                sound.currentTime = 0;
                sound.play().then(() => {
                    console.log(`${type === '.' ? 'ç‚¹' : 'åˆ’'}éŸ³æ•ˆæ’­æ”¾æˆåŠŸ`);
                }).catch(e => {
                    console.error(`éŸ³æ•ˆæ’­æ”¾å¤±è´¥:`, e);
                    // å°è¯•é‡æ–°åˆå§‹åŒ–éŸ³é¢‘
                    audioInitialized = false;
                    initAudio();
                });
            } catch (e) {
                console.error('æ’­æ”¾éŸ³æ•ˆæ—¶å‘ç”Ÿé”™è¯¯:', e);
            }
        }

        // æ‘©æ–¯å¯†ç æ˜ å°„è¡¨
        const morseCodeMap = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 'G': '--.', 
            'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 
            'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-', 'U': '..-', 
            'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--', 'Z': '--..',
            '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....', 
            '6': '-....', '7': '--...', '8': '---..', '9': '----.', '0': '-----',
            ' ': '/', '.': '.-.-.-', ',': '--..--', '?': '..--..', "'": '.----.', 
            '!': '-.-.--', '/': '-..-.', '(': '-.--.', ')': '-.--.-', '&': '.-...', 
            ':': '---...', ';': '-.-.-.', '=': '-...-', '+': '.-.-.', '-': '-....-', 
            '_': '..--.-', '"': '.-..-.', '$': '...-..-', '@': '.--.-.'
        };

        // åè½¬æ˜ å°„è¡¨ï¼Œç”¨äºç¿»è¯‘
        const reverseMorseMap = Object.fromEntries(
            Object.entries(morseCodeMap).map(([key, value]) => [value, key])
        );

        // å­—ç¬¦è½¬æ‘©æ–¯å¯†ç 
        function textToMorse(text) {
            return text.toUpperCase().split('').map(char => 
                morseCodeMap[char] || char
            ).join(' ');
        }

        // æ‘©æ–¯å¯†ç è½¬å­—ç¬¦
        function morseToText(morse) {
            return morse.split(' ').map(code => 
                reverseMorseMap[code] || code
            ).join('');
        }

        // ç”Ÿæˆçˆ±å¿ƒå¼¹å¹•
        function createFloatingHeart() {
            const hearts = ['â¤ï¸', 'ğŸ’–', 'ğŸ’—', 'ğŸ’“', 'ğŸ’•', 'ğŸ’', 'ğŸ’'];
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = hearts[Math.floor(Math.random() * hearts.length)];
            
            // éšæœºä½ç½®å’ŒåŠ¨ç”»æ—¶é—´
            heart.style.left = `${Math.random() * 100}vw`;
            heart.style.animationDuration = `${5 + Math.random() * 10}s`;
            heart.style.fontSize = `${16 + Math.random() * 24}px`;
            heart.style.opacity = `${0.5 + Math.random() * 0.5}`;
            
            document.getElementById('floatingHearts').appendChild(heart);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                heart.remove();
            }, 15000);
        }

        // æ§åˆ¶çˆ±å¿ƒé—ªçƒ
        function blinkHeart(morseCode) {
            const heart = document.getElementById('heart');
            const symbols = morseCode.split('');
            let index = 0;
            
            // åˆ›å»ºæ‘©æ–¯å¯†ç æ˜¾ç¤º
            const morseDisplay = document.getElementById('morseCode');
            morseDisplay.innerHTML = '';
            
            // å­˜å‚¨æ¯ä¸ªç¬¦å·çš„å…ƒç´ å¼•ç”¨
            const symbolElements = [];
            
            symbols.forEach(symbol => {
                const element = document.createElement('span');
                if (symbol === '.') {
                    element.className = 'morse-dot';
                } else if (symbol === '-') {
                    element.className = 'morse-dash';
                } else if (symbol === ' ') {
                    element.innerHTML = '&nbsp;&nbsp;';
                } else if (symbol === '/') {
                    element.innerHTML = '&nbsp;&nbsp;&nbsp;&nbsp;';
                }
                morseDisplay.appendChild(element);
                symbolElements.push(element);
            });
            
            // æ˜¾ç¤ºç¿»è¯‘ç»“æœ
            document.getElementById('displayMessage').textContent = document.getElementById('messageInput').value;
            document.getElementById('morseTranslation').textContent = morseCode;
            
            // æ˜¾ç¤ºæ‰€æœ‰å†…å®¹
            document.getElementById('morseDisplay').classList.remove('opacity-0');
            document.getElementById('messageDisplay').classList.remove('opacity-0');
            document.getElementById('heartDisplay').classList.remove('opacity-0');
            
            // æ‘©æ–¯å¯†ç æ ‡å‡†æ—¶é—´å•ä½ï¼ˆæ¯«ç§’ï¼‰
            const timeUnit = 200;
            
            // é‡ç½®çˆ±å¿ƒçŠ¶æ€
            function resetHeart() {
                heart.style.transform = 'scale(1)';
                heart.style.color = '#FF6B8B';
                heart.style.boxShadow = '0 0 0 rgba(255, 51, 102, 0)';
                
                // æ¸…é™¤æ‰€æœ‰ç¬¦å·çš„æ´»åŠ¨çŠ¶æ€
                symbolElements.forEach(el => {
                    if (el.classList.contains('morse-active')) {
                        el.classList.remove('morse-active');
                    }
                });
            }
            
            // æ¿€æ´»çˆ±å¿ƒçŠ¶æ€
            function activateHeart() {
                heart.style.transform = 'scale(1.3)';
                heart.style.color = '#FF3366';
                heart.style.boxShadow = '0 0 20px rgba(255, 51, 102, 0.7)';
                
                // æ¿€æ´»å½“å‰ç¬¦å·
                const currentElement = symbolElements[index];
                if (currentElement) currentElement.classList.add('morse-active');
            }
            
            // å¼€å§‹é—ªçƒåŠ¨ç”»
            function nextBlink() {
                if (index >= symbols.length) {
                    resetHeart();
                    setTimeout(() => {
                        index = 0;
                        nextBlink();
                    }, timeUnit * 7); // å•è¯é—´é—´éš”ï¼š7ä¸ªæ—¶é—´å•ä½
                    return;
                }
                
                const symbol = symbols[index];
                
                // é‡ç½®çŠ¶æ€
                resetHeart();
                
                if (symbol === '.') {
                    // ç‚¹ï¼š1ä¸ªæ—¶é—´å•ä½
                    activateHeart();
                    playSound('.');
                    
                    setTimeout(() => {
                        resetHeart();
                        index++;
                        setTimeout(nextBlink, timeUnit); // å­—ç¬¦å†…é—´éš”ï¼š1ä¸ªæ—¶é—´å•ä½
                    }, timeUnit);
                } else if (symbol === '-') {
                    // åˆ’ï¼š3ä¸ªæ—¶é—´å•ä½
                    activateHeart();
                    playSound('-');
                    
                    setTimeout(() => {
                        resetHeart();
                        index++;
                        setTimeout(nextBlink, timeUnit); // å­—ç¬¦å†…é—´éš”ï¼š1ä¸ªæ—¶é—´å•ä½
                    }, timeUnit * 3);
                } else if (symbol === ' ') {
                    // å­—ç¬¦é—´ç©ºæ ¼ï¼š3ä¸ªæ—¶é—´å•ä½
                    index++;
                    setTimeout(nextBlink, timeUnit * 3);
                } else if (symbol === '/') {
                    // å•è¯é—´ç©ºæ ¼ï¼š7ä¸ªæ—¶é—´å•ä½
                    index++;
                    setTimeout(nextBlink, timeUnit * 7);
                } else {
                    // å…¶ä»–å­—ç¬¦ï¼š1ä¸ªæ—¶é—´å•ä½
                    index++;
                    setTimeout(nextBlink, timeUnit);
                }
            }
            
            // å¼€å§‹åŠ¨ç”»åºåˆ—
            setTimeout(nextBlink, timeUnit * 2);
        }

        // ç‚¹å‡»æŒ‰é’®äº‹ä»¶
        document.getElementById('convertBtn').addEventListener('click', function() {
            const message = document.getElementById('messageInput').value.trim();
            if (!message) {
                alert('è¯·è¾“å…¥è¦è½¬æ¢çš„å†…å®¹ï¼');
                return;
            }
            
            // åˆå§‹åŒ–éŸ³é¢‘ï¼ˆå¦‚æœå°šæœªåˆå§‹åŒ–ï¼‰
            initAudio();
            
            // è½¬æ¢ä¸ºæ‘©æ–¯å¯†ç 
            const morseCode = textToMorse(message);
            
            // å¼€å§‹çˆ±å¿ƒé—ªçƒ
            blinkHeart(morseCode);
            
            // æ¸…é™¤ç°æœ‰çˆ±å¿ƒå¼¹å¹•
            document.getElementById('floatingHearts').innerHTML = '';
            
            // ç”Ÿæˆæ–°çš„çˆ±å¿ƒå¼¹å¹•
            const heartInterval = setInterval(createFloatingHeart, 300);
            
            // 15ç§’ååœæ­¢ç”Ÿæˆæ–°çˆ±å¿ƒ
            setTimeout(() => {
                clearInterval(heartInterval);
            }, 15000);
        });

        // å›è½¦è§¦å‘è½¬æ¢
        document.getElementById('messageInput').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                document.getElementById('convertBtn').click();
            }
        });
    </script>
</body>
</html>    
